<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-header-panel/paper-header-panel.html">
<link rel="import" href="../paper-toolbar/paper-toolbar.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-tabs/paper-tabs.html">
<link rel="import" href="../paper-tabs/paper-tab.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-media-query/iron-media-query.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-item/paper-icon-item.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../iron-icons/maps-icons.html">
<link rel="import" href="../iron-icons/communication-icons.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="./t-header-styles.html">

<!--
  `t-header`
  Header component

  @demo demo/index.html
-->

<dom-module id="t-header">
    <template>
    <style is="custom-style" include="t-header-styles iron-flex iron-flex-alignment "></style>


    <iron-media-query query="(max-width: 1024px) and (min-width: 700px)" query-matches="{{_isTablet}}"></iron-media-query>
    <iron-media-query query="(min-width : 320px) and (max-width : 480px)" query-matches="{{_isMobile}}"></iron-media-query>

    <div class="layout horizontal topbar">
      <div class="flex layout horizontal topbar-left">
        <div class="item"><iron-icon class="icon" icon="[[dataOptions.topBar.phoneIcon]]"></iron-icon>[[dataOptions.topBar.phone]]</div>
        <div hidden$="[[_isMobile]]" class="item"><iron-icon class="icon" icon="[[dataOptions.topBar.emailIcon]]"></iron-icon><a href$="mailto:[[dataOptions.topBar.email]]" >[[dataOptions.topBar.email]]</a></div>
      </div>

      <div class="layout horizontal right-topbar ">
        <template is="dom-repeat" items="[[dataOptions.secondaryMenu]]">
          <div class="right-item layout horizontal" data-event="[[item.eventName]]" on-tap="_secondaryMenuChanged"  >
            <div class="search" hidden$="{{_isMobile}}">
              <iron-icon class="icon" icon="[[item.icon]]"></iron-icon>
            <div hidden$="[[_hideCount(item.count)]]" class="notification-count">[[item.count]]</div>
            </div>
            <div class="right-text" hidden$="[[_notDesktop]]">[[item.label]]</div>
          </div>
        </template>
        <div class="layout horizontal" hidden$="[[_isMobile]]">
          <div><iron-icon hidden$="[[_notDesktop]]" class="flag" src="[[_selectedFlag]]"></iron-icon></div>
          <div>
          <paper-dropdown-menu hidden$="[[_notDesktop]]"  no-label-float class="dropdown" on-iron-select="_countryChanged">
            <paper-listbox  class="dropdown-content" selected="[[_selectedCountry]]">
              <template is="dom-repeat" items="[[dataOptions.countries]]">
                <paper-item data-icon$="[[item.icon]]"><iron-icon class="icon" src="[[item.icon]]"></iron-icon>[[item.label]]</paper-item>
              </template>
            </paper-listbox>
          </paper-dropdown-menu>
          </div>

          <div>
          <paper-menu-button hidden$="[[!_notDesktop]]" class="dropdown icon-menu" on-iron-select="_countryChanged">
            <paper-icon-button src="[[_selectedFlag]]" class="dropdown-trigger"></paper-icon-button>
            <paper-menu class="dropdown-content">
              <template is="dom-repeat" items="[[dataOptions.countries]]">
                <paper-item data-icon$="[[item.icon]]"><iron-icon class="icon" src="[[item.icon]]"></iron-icon>[[item.label]]</paper-item>
              </template>
            </paper-menu>
          </paper-menu-button >
          <iron-icon hidden$="[[!_isTablet]]" icon="paper-dropdown-menu:arrow-drop-down" suffix="" class="dropdown style-scope paper-dropdown-menu x-scope iron-icon-0"><svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" class="style-scope iron-icon" style="pointer-events: none; display: block; width: 100%; height: 100%;"><g class="style-scope iron-icon"><path d="M7 10l5 5 5-5z" class="style-scope iron-icon"></path></g></svg> </iron-icon>
          </div>

          <div>
          <paper-dropdown-menu on-iron-select="_currencyChanged" no-label-float class="dropdown currency-code">
            <paper-listbox selected-attribute="value" class="dropdown-content" selected="[[_selectedCurrency]]">
              <template is="dom-repeat" items="[[dataOptions.currencies]]" selected-item-label="label">
                <paper-item label="[[item.label]]" >[[item.value]]</paper-item>
              </template>
            </paper-listbox>
          </paper-dropdown-menu>
          </div>

        </div>
        <div class="signup-section" >
          <iron-icon icon="account-circle"></iron-icon>
          <template is="dom-if" if="[[!user]]">
            <paper-button class="action-button" on-tap="_signupTapped">[[dataOptions.topBar.signIn.label]]</paper-button>/<paper-button class="action-button" on-tap="_signinTapped" >[[dataOptions.topBar.signIn.label]]</paper-button>
          </template>
          <template is="dom-if" if="[[user]]">
            <paper-button class="action-button" on-tap="_userProfileTapped">[[user.name]]</paper-button>
          </template>
        </div>

      </div>
    </div>
    <paper-header-panel class="flex paper-header-panel">
      <paper-toolbar class="menu-content" >
        <div>
          <iron-icon class="icon" icon="menu" on-tap="_openDrawer" hidden$="[[!_isMobile]]"></iron-icon>
        <img class="logo" src="[[dataOptions.logo]]" />
        </div>

        <div class="flex tabs" >
          <paper-tabs hidden$="[[_isMobile]]" class="flex primary-menu" scrollable selected="{{dataOptions.primaryMenu.selectedIndex}}" on-iron-select="_tabChanged">
            <template is="dom-repeat" items="[[dataOptions.primaryMenu.items]]">
              <paper-tab><iron-icon class="icon" icon="[[item.icon]]"></iron-icon>[[item.label]]</paper-tab>
            </template>
          </paper-tabs>
        </div>
        <div class="flex-2 end-justified horizontal layout secondary-menu">
          <div class="secondary-menu horizontal layout" on-tap="_shoppingCartOpened">
            <div>
              <iron-icon class="icon" icon="[[dataOptions.shoppingCart.icon]]"></iron-icon>
              <div hidden$="[[_hideCount(item.count)]]" class="notification-count">[[dataOptions.shoppingCart.count]]</div>
            </div>
            <div class="right-text" hidden$="[[_notDesktop]]">[[dataOptions.shoppingCart.label]]</div>
          </div>
        </div>
      </paper-toolbar>
    </paper-header-panel>

    <paper-drawer-panel disable-edge-swipe id="drawer" hidden$="[[!_isMobile]]" drawer>
      <div drawer class="drawer">
        <iron-selector selected="0">
          <template is="dom-repeat" items="[[dataOptions.primaryMenu.items]]">
            <paper-item class="drawer-item"><iron-icon class="icon" icon="[[item.icon]]"></iron-icon>[[item.label]]</paper-item>
          </template>
        </iron-selector>

        <template is="dom-repeat" items="[[dataOptions.secondaryMenu]]">
          <paper-item class="secondary-item drawer-item" data-event="[[item.eventName]]" on-tap="_secondaryMenuChanged">[[item.label]]
            <div hidden$="[[_hideCount(item.count)]]" class=" drawer-search">[[item.count]]</div>
          </paper-item>
        </template>

        <paper-item class="secondary-item layout horizontal drawer-item">
          <div class="flex">Currency</div>
          <div class="end end-justified">
            <paper-dropdown-menu dynamic-align on-iron-select="_currencyChanged" no-label-float class="dropdown currency-code">
              <paper-listbox selected-attribute="value" class="dropdown-content" selected="[[_selectedCurrency]]">
                <template is="dom-repeat" items="[[dataOptions.currencies]]" selected-item-label="label">
                  <paper-item label="[[item.label]]" >[[item.value]]</paper-item>
                </template>
              </paper-listbox>
            </paper-dropdown-menu>
          </div>
        </paper-item>
        <paper-item class="secondary-item layout horizontal drawer-item">
          <div class="flex">Country</div>
          <div class="end end-justified">
            <paper-menu-button dynamic-align  class="icon-menu" on-iron-select="_countryChanged">
              <paper-icon-button src="[[_selectedFlag]]" class="dropdown-trigger"></paper-icon-button>
              <paper-menu dynamic-align class="dropdown-content">
                <template is="dom-repeat" items="[[dataOptions.countries]]">
                  <paper-item data-icon$="[[item.icon]]"><iron-icon class="icon" src="[[item.icon]]"></iron-icon>[[item.label]]</paper-item>
                </template>
              </paper-menu>
            </paper-menu-button >
            <iron-icon icon="paper-dropdown-menu:arrow-drop-down" suffix="" class="style-scope paper-dropdown-menu x-scope iron-icon-0"><svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" class="style-scope iron-icon" style="pointer-events: none; display: block; width: 100%; height: 100%;"><g class="style-scope iron-icon"><path d="M7 10l5 5 5-5z" class="style-scope iron-icon"></path></g></svg> </iron-icon>
          </div>
        </paper-item>
      </div>
    </paper-drawer-panel>

  </template>

  <script>
Polymer({
  is: 't-header',

  properties: {
    _selectedCountry:{
      type: Number,
      value: 0
    },
    _selectedCurrency:{
      type: Number,
      value: 0
    },
    _selectedFlag:{
      type: Number,
      value: 0
    },
    dataOptions: {
      type: Object,
      notify: true,
      required:true
    },
    user: {
      type: Object,
      required: true,
      value: null
    },
    _isMobile:{
      type:Boolean
    },
    _isTablet:{
      type:Boolean
    },
    _notDesktop: {
      type: Boolean,
      computed: '_isSmallScreen(_isTablet, _isMobile)'
    }
  },

  _currencyChanged: function(e){
    let selectedItem = e.target.selectedItem;
    if(selectedItem){
      this.fire(this.dataOptions.events.currencyChanged);
    }
  },

  _countryChanged: function(e){
    let selectedItem = e.target.selectedItem;
    if(selectedItem){
      this._selectedFlag = selectedItem.getAttribute('data-icon');
      this.fire(this.dataOptions.events.countryChanged);
    }
  },

  _tabChanged: function(e,index){
    const header = this;
    const selectedTab = this.dataOptions.primaryMenu.items.filter(function(item,index){
      return( index === header.dataOptions.primaryMenu.selectedIndex);
    });
    if(selectedTab.length> 0){
      if(selectedTab[0].eventName){
        this.fire(selectedTab[0].eventName);
      }
      else if(selectedTab[0].url) {
        window.location=  selectedTab[0].url;
        e.stopPropagation();
      }
    }
  },

  _hideCount: function(count){
    return count === 0;
  },

  _isSmallScreen: function(isTablet, isMobile){
    return isTablet || isMobile;
  },

  _shoppingCartOpened: function(e){
    this.fire(this.dataOptions.shoppingCart.eventName);
  },

  _secondaryMenuChanged: function(e){
    this.fire(e.target.getAttribute('data-event'));
    this.$.drawer.closeDrawer();
  },

  _signupTapped: function(e){
    if(this.dataOptions.topBar.signUp.eventName){
      this.fire(this.dataOptions.topBar.signUp.eventName);
    }
    else if(this.dataOptions.topBar.signUp.url) {
      window.location = this.dataOptions.topBar.signUp.url;
      e.stopPropagation();
    }
  },

  _signinTapped: function(e){
    if(this.dataOptions.topBar.signIn.eventName){
      this.fire(this.dataOptions.topBar.signIn.eventName);
    }
    else if(this.dataOptions.topBar.signIn.url) {
      window.location = this.dataOptions.topBar.signIn.url;
      e.stopPropagation();
    }
  },

  _userProfileTapped: function(e){
    if(this.user.eventName){
      this.fire(this.user.eventName);
    }
    else if(this.user.url) {
      window.location = this.user.url;
      e.stopPropagation();
    }
  },

  _openDrawer: function(e){
    this.$.drawer.openDrawer();
  }
})
  </script>
</dom-module>
