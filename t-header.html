<!-- <link rel="import" href="../polymer/polymer.html"> -->
<link rel="import" href="../paper-header-panel/paper-header-panel.html">
<link rel="import" href="../paper-toolbar/paper-toolbar.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-tabs/paper-tabs.html">
<link rel="import" href="../paper-tabs/paper-tab.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-media-query/iron-media-query.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-menu-button/paper-menu-button.html">
<link rel="import" href="../paper-item/paper-icon-item.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../iron-icons/maps-icons.html">
<link rel="import" href="../iron-icons/communication-icons.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="./t-header-styles.html">

<!--
	`t-header`
	Header component

	@demo demo/index.html
-->

<dom-module id="t-header">
	<template>
		<style is="custom-style" include="t-header-styles iron-flex iron-flex-alignment "></style>

		<iron-media-query query="(max-width: 1024px) and (min-width: 700px)" query-matches="{{_isTablet}}"></iron-media-query>
		<iron-media-query query="(min-width : 320px) and (max-width : 480px)" query-matches="{{_isMobile}}"></iron-media-query>

		<div class="layout horizontal topbar">
			<div class="flex layout horizontal topbar-left">
				<template is="dom-repeat" items="[[_getTopStartMenu(_isMobile,data.topStartMenu)]]">
					<div class="item">
            <iron-icon class="icon" icon="[[item.icon]]"></iron-icon>
            <a href$="[[item.url]]" >[[item.title]]</a>
          </div>
				</template>
			</div>

			<div class="layout horizontal right-topbar ">
				<div class="right-item layout horizontal" data-event="[[data.recentSearch.eventName]]" on-tap="_recentSearchTapped"  >
					<div class="search" hidden$="{{_isMobile}}">
						<iron-icon class="icon" icon="[[data.recentSearch.icon]]"></iron-icon>
					<div hidden$="[[_hideCount(data.recentSearch.count)]]" class="notification-count">[[data.recentSearch.count]]</div>
					</div>
					<div class="right-text" hidden$="[[_notDesktop]]">[[data.recentSearch.label]]</div>
				</div>
				<!-- <template is="dom&#45;repeat" items="[[data.secondaryMenu]]"> -->
				<!--   <div class="right&#45;item layout horizontal" data&#45;event="[[item.eventName]]" on&#45;tap="_secondaryMenuChanged"  > -->
				<!--     <div class="search" hidden$="{{_isMobile}}"> -->
				<!--       <iron&#45;icon class="icon" icon="[[item.icon]]"></iron&#45;icon> -->
				<!--     <div hidden$="[[_hideCount(item.count)]]" class="notification&#45;count">[[item.count]]</div> -->
				<!--     </div> -->
				<!--     <div class="right&#45;text" hidden$="[[_notDesktop]]">[[item.label]]</div> -->
				<!--   </div> -->
				<!-- </template> -->
				<div class="layout horizontal" hidden$="[[_isMobile]]">
					<template is="dom-repeat" items="[[data.topEndMenu]]">
						<div hidden$="[[!item.isIconMenu]]">
							<iron-icon hidden$="[[_notDesktop]]" class="flag" src="[[_selectedFlag]]"></iron-icon></div>
						<div>
							<paper-dropdown-menu hidden$="[[_hideIfResponsiveScreenAndIconMenu(_notDesktop, item.isIconMenu)]]" no-label-float class$="[[_getDropdownClasses(item.isIconMenu)]]" on-iron-select="_topEndMenuChanged" >
								<paper-listbox  class="dropdown-content"  selected="{{ item.selectedItem }}">
									<template is="dom-repeat" items="[[item.options]]" as="option">
										<template is="dom-if" if="[[item.isIconMenu]]">
											<paper-item data-icon$="[[option.icon]]" data-value$="[[option.value]]">
												<iron-icon hidden$="[[!item.isIconMenu]]" class="icon" src="[[option.icon]]"></iron-icon>
								[[option.title]]
											</paper-item>
										</template>
										<template is="dom-if" if="[[!item.isIconMenu]]">
											<paper-item  label="[[option.value]]">
												[[_getDropdownLabel(option.value, option.title)]]
											</paper-item>
										</template>
									</template>
								</paper-listbox>
							</paper-dropdown-menu>
						</div>

						<!-- </template> -->
						<!-- <div> -->
						<!-- 	<paper&#45;dropdown&#45;menu hidden$="[[_notDesktop]]"  no&#45;label&#45;float class="dropdown" on&#45;iron&#45;select="_countryChanged"> -->
						<!-- 		<paper&#45;listbox  class="dropdown&#45;content" selected="[[_selectedCountry]]"> -->
						<!-- 			<template is="dom&#45;repeat" items="[[data.countries]]"> -->
						<!-- 				<paper&#45;item data&#45;icon$="[[item.icon]]"><iron&#45;icon class="icon" src="[[item.icon]]"></iron&#45;icon>[[item.label]]</paper&#45;item> -->
						<!-- 			</template> -->
						<!-- 		</paper&#45;listbox> -->
						<!-- 	</paper&#45;dropdown&#45;menu> -->
						<!-- </div> -->

						<div hidden$="[[!item.isIconMenu]]">
							<paper-menu-button dynamic-align  hidden$="[[!_notDesktop]]" class="dropdown icon-menu" on-iron-select="_countryChanged">
								<paper-icon-button src="[[_selectedFlag]]" class="dropdown-trigger"></paper-icon-button>
								<paper-menu class="dropdown-content">
									<template is="dom-repeat" items="[[item.options]]">
										<paper-item data-icon$="[[item.icon]]"><iron-icon class="icon" src="[[item.icon]]"></iron-icon>[[item.title]]</paper-item>
									</template>
								</paper-menu>
							</paper-menu-button >
							<iron-icon hidden$="[[!_isTablet]]" icon="paper-dropdown-menu:arrow-drop-down" suffix="" class="dropdown style-scope paper-dropdown-menu x-scope iron-icon-0"><svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" class="style-scope iron-icon" style="pointer-events: none; display: block; width: 100%; height: 100%;"><g class="style-scope iron-icon"><path d="M7 10l5 5 5-5z" class="style-scope iron-icon"></path></g></svg> </iron-icon>
						</div>
	</template>
	<!-- <div> -->
	<!-- 	<paper&#45;dropdown&#45;menu on&#45;iron&#45;select="_currencyChanged" no&#45;label&#45;float class="dropdown currency&#45;code"> -->
	<!-- 		<paper&#45;listbox selected&#45;attribute="value" class="dropdown&#45;content" selected="[[_selectedCurrency]]"> -->
	<!-- 			<template is="dom&#45;repeat" items="[[data.currencies]]" selected&#45;item&#45;label="label"> -->
	<!-- 				<paper&#45;item label="[[item.label]]" >[[item.value]]</paper&#45;item> -->
	<!-- 			</template> -->
	<!-- 		</paper&#45;listbox> -->
	<!-- 	</paper&#45;dropdown&#45;menu> -->
	<!-- </div> -->
				</div>
				<div class="signup-section" >
					<div hidden$="[[!user.isLoggedIn]]">
						<div hidden$="[[!_hasUrlTrigger(user.postLogin)]]">
							<paper-button icon="[[user.postLogin.icon]]" class="action-button" on-tap="_userSectionTapped">
								<iron-icon icon="[[user.postLogin.icon]]"></iron-icon>
					[[user.postLogin.title]]
							</paper-button>
						</div>
						<div hidden$="[[_hasUrlTrigger(user.postLogin)]]">
							<paper-menu-button dynamic-align >
								<paper-button icon="[[user.preLogin.icon]]" class="dropdown-trigger action-button" >
									<iron-icon icon="[[user.preLogin.icon]]"></iron-icon>
								[[user.postLogin.title]]
								</paper-button>
               <div class="dropdown-content user-section-content">
								<content select=".prelogin-content" ></content>
               </div>
							</paper-menu-button>
						</div>
					</div>
					<div hidden$="[[user.isLoggedIn]]">
						<div hidden$="[[!_hasUrlTrigger(user.preLogin)]]">
							<paper-button icon="[[user.preLogin.icon]]" class="action-button" on-tap="_userSectionTapped">
								<iron-icon icon="[[user.preLogin.icon]]"></iron-icon>
								[[user.preLogin.title]]
							</paper-button>
						</div>
						<div hidden$="[[_hasUrlTrigger(user.preLogin)]]">
							<paper-menu-button >
								<paper-button icon="[[user.preLogin.icon]]" class="dropdown-trigger action-button" >
									<iron-icon icon="[[user.preLogin.icon]]"></iron-icon>
								[[user.preLogin.title]]
								</paper-button>
								<content select=".prelogin-content" class="dropdown-content" ></content>
							</paper-menu-button>
						</div>
					</div>
				</div>

			</div>
		</div>
		<paper-header-panel class="flex paper-header-panel">
			<paper-toolbar class="menu-content" >
				<div>
					<iron-icon class="icon" icon="menu" on-tap="_openDrawer" hidden$="[[!_isMobile]]"></iron-icon>
				<img class="logo" src="[[data.logo]]" />
				</div>

				<div class="flex tabs" >
					<paper-tabs hidden$="[[_isMobile]]" class="flex primary-menu" scrollable selected="{{data.primaryMenu.selectedIndex}}" on-iron-select="_tabChanged">
						<template is="dom-repeat" items="[[data.primaryMenu.items]]">
							<paper-tab><iron-icon class="icon" icon="[[item.icon]]"></iron-icon>[[item.label]]</paper-tab>
						</template>
					</paper-tabs>
				</div>
				<div class="flex-2 end-justified horizontal layout secondary-menu">
					<template is="dom-repeat" items="[[data.secondaryMenu]]">
						<div class="secondary-menu horizontal layout" data-event="[[item.eventName]]" on-tap="_secondaryMenuChanged"  >
							<div >
								<iron-icon class="icon" icon="[[item.icon]]"></iron-icon>
							<div hidden$="[[_hideCount(item.count)]]" class="notification-count">[[item.count]]</div>
							</div>
							<div class="right-text" hidden$="[[_notDesktop]]">[[item.label]]</div>
						</div>
					</template>
					<!-- <div class="secondary&#45;menu horizontal layout" on&#45;tap="_recentSearchTapped"> -->
					<!--   <div> -->
					<!--     <iron&#45;icon class="icon" icon="[[data.shoppingCart.icon]]"></iron&#45;icon> -->
					<!--     <div hidden$="[[_hideCount(item.count)]]" class="notification&#45;count">[[data.shoppingCart.count]]</div> -->
					<!--   </div> -->
					<!--   <div class="right&#45;text" hidden$="[[_notDesktop]]">[[data.shoppingCart.label]]</div> -->
					<!-- </div> -->
				</div>
			</paper-toolbar>
		</paper-header-panel>

		<paper-drawer-panel disable-edge-swipe id="drawer" hidden$="[[!_isMobile]]" drawer>
			<div drawer class="drawer">
				<iron-selector selected="0">
					<template is="dom-repeat" items="[[data.primaryMenu.items]]">
						<paper-item class="drawer-item"><iron-icon class="icon" icon="[[item.icon]]"></iron-icon>[[item.label]]</paper-item>
					</template>
        </iron-selector>

        <paper-item class="secondary-item drawer-item" data-event="[[data.recentSearch.eventName]]" on-tap="_secondaryMenuChanged">[[data.recentSearch.label]]
          <div hidden$="[[_hideCount(data.recentSearch.count)]]" class=" drawer-search">[[data.recentSearch.count]]</div>
        </paper-item>

        <!-- <template is="dom&#45;repeat" items="[[data.secondaryMenu]]"> -->
        <!--   <paper&#45;item class="secondary&#45;item drawer&#45;item" data&#45;event="[[item.eventName]]" on&#45;tap="_secondaryMenuChanged">[[item.label]] -->
        <!--     <div hidden$="[[_hideCount(item.count)]]" class=" drawer&#45;search">[[item.count]]</div> -->
        <!--   </paper&#45;item> -->
        <!-- </template> -->

        <template is="dom-repeat" items="[[data.topEndMenu]]">
          <paper-item class="secondary-item layout horizontal drawer-item">
            <div class="flex">[[item.label]]</div>
            <div class="end end-justified">
              <template is="dom-if" if="[[!item.isIconMenu]]">
                <paper-dropdown-menu dynamic-align on-iron-select="_topEndMenuChanged" no-label-float class$="[[ _getDropdownClasses(item.isIconMenu)]]">
                  <paper-listbox class="dropdown-content" selected="{{ item.selectedItem }}">
                    <template is="dom-repeat" items="[[item.options]]" as="option" selected-item-label="label">
                      <paper-item label="[[option.value]]" data-value$="[[option.value]]" >[[_getDropdownLabel(option.value, option.title)]]
                      </paper-item>
                    </template>
                  </paper-listbox>
                </paper-dropdown-menu>
              </template>
            </div>
            <template is="dom-if" if="[[item.isIconMenu]]">
              <paper-menu-button dynamic-align  class="icon-menu" on-iron-select="_topEndMenuChanged">
                <paper-icon-button src="[[_selectedFlag]]" class="dropdown-trigger"></paper-icon-button>
                <paper-menu dynamic-align class="dropdown-content">
                  <template is="dom-repeat" items="[[item.options]]" as="option">
                    <paper-item data-icon$="[[option.icon]]"><iron-icon class="icon" src="[[option.icon]]"></iron-icon>[[option.title]]</paper-item>
                  </template>
                </paper-menu>
              </paper-menu-button >
              <iron-icon icon="paper-dropdown-menu:arrow-drop-down" suffix="" class="style-scope paper-dropdown-menu x-scope iron-icon-0"><svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" class="style-scope iron-icon" style="pointer-events: none; display: block; width: 100%; height: 100%;"><g class="style-scope iron-icon"><path d="M7 10l5 5 5-5z" class="style-scope iron-icon"></path></g></svg> </iron-icon>
            </template>
          </paper-item>
        </template>


        <!-- <paper&#45;item class="secondary&#45;item layout horizontal drawer&#45;item"> -->
        <!--   <div class="flex">Currency</div> -->
        <!--   <div class="end end&#45;justified"> -->
        <!--     <paper&#45;dropdown&#45;menu dynamic&#45;align on&#45;iron&#45;select="_currencyChanged" no&#45;label&#45;float class="dropdown currency&#45;code"> -->
        <!--       <paper&#45;listbox selected&#45;attribute="value" class="dropdown&#45;content" selected="[[_selectedCurrency]]"> -->
        <!--         <template is="dom&#45;repeat" items="[[data.currencies]]" selected&#45;item&#45;label="label"> -->
        <!--           <paper&#45;item label="[[item.label]]" >[[item.value]]</paper&#45;item> -->
        <!--         </template> -->
        <!--       </paper&#45;listbox> -->
        <!--     </paper&#45;dropdown&#45;menu> -->
        <!--   </div> -->
        <!-- </paper&#45;item> -->
        <!-- <paper&#45;item class="secondary&#45;item layout horizontal drawer&#45;item"> -->
        <!--   <div class="flex">Country</div> -->
        <!--   <div class="end end&#45;justified"> -->
        <!--     <paper&#45;menu&#45;button dynamic&#45;align  class="icon&#45;menu" on&#45;iron&#45;select="_countryChanged"> -->
        <!--       <paper&#45;icon&#45;button src="[[_selectedFlag]]" class="dropdown&#45;trigger"></paper&#45;icon&#45;button> -->
        <!--       <paper&#45;menu dynamic&#45;align class="dropdown&#45;content"> -->
        <!--         <template is="dom&#45;repeat" items="[[data.countries]]"> -->
        <!--           <paper&#45;item data&#45;icon$="[[item.icon]]"><iron&#45;icon class="icon" src="[[item.icon]]"></iron&#45;icon>[[item.label]]</paper&#45;item> -->
        <!--         </template> -->
        <!--       </paper&#45;menu> -->
        <!--     </paper&#45;menu&#45;button > -->
        <!--     <iron&#45;icon icon="paper&#45;dropdown&#45;menu:arrow&#45;drop&#45;down" suffix="" class="style&#45;scope paper&#45;dropdown&#45;menu x&#45;scope iron&#45;icon&#45;0"><svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" class="style&#45;scope iron&#45;icon" style="pointer&#45;events: none; display: block; width: 100%; height: 100%;"><g class="style&#45;scope iron&#45;icon"><path d="M7 10l5 5 5&#45;5z" class="style&#45;scope iron&#45;icon"></path></g></svg> </iron&#45;icon> -->
        <!--   </div> -->
        <!-- </paper&#45;item> -->
      </div>
    </paper-drawer-panel>

    </template>

    <script>
Polymer({
  is: 't-header',

  properties: {
    _selectedCountry:{
      type: Number,
      value: 0
    },
    _selectedCurrency:{
      type: Number,
      value: 0
    },
    _selectedFlag:{
      type: Number,
      value: 0
    },
    data: {
      type: Object,
      notify: true,
      required:true
    },
    user: {
      type: Object,
      value: null
    },
    _isMobile:{
      type:Boolean
    },
    _isTablet:{
      type:Boolean
    },
    _notDesktop: {
      type: Boolean,
      computed: '_isSmallScreen(_isTablet, _isMobile)'
    }
  },

  _currencyChanged: function(e){
    let selectedItem = e.target.selectedItem;
    if(selectedItem){
      this.fire(this.data.events.currencyChanged);
    }
  },

  _topEndMenuChanged: function(e){
    var selectedDropdown =  e.model.item;
    var selectedPaperItem =  e.detail.item;
    var selectedItem = null;
    selectedDropdown.options.forEach(function(item){
      if(item.value === selectedPaperItem.getAttribute('data-value')){
        selectedItem = item;
        return;
      }
    });
    if(selectedItem){
      if(selectedDropdown.isIconMenu)
        this._selectedFlag = selectedItem.icon;
      this.fire(selectedDropdown.eventName);
    }
  },

  _tabChanged: function(e,index){
    const header = this;
    const selectedTab = this.data.primaryMenu.items.filter(function(item,index){
      return( index === header.data.primaryMenu.selectedIndex);
    });
    if(selectedTab.length> 0){
      if(selectedTab[0].eventName){
        this.fire(selectedTab[0].eventName);
      }
      else if(selectedTab[0].url) {
        window.location=  selectedTab[0].url;
        e.stopPropagation();
      }
    }
  },

  _hideCount: function(count){
    return count === 0;
  },

  _isSmallScreen: function(isTablet, isMobile){
    return isTablet || isMobile;
  },

  _recentSearchTapped: function(e){
    this.fire(this.data.recentSearch.eventName);
  },

  _secondaryMenuChanged: function(e){
    this.fire(e.target.getAttribute('data-event'));
    this.$.drawer.closeDrawer();
  },

  _signupTapped: function(e){
    if(this.data.topBar.signUp.eventName){
      this.fire(this.data.topBar.signUp.eventName);
    }
    else if(this.data.topBar.signUp.url) {
      window.location = this.data.topBar.signUp.url;
      e.stopPropagation();
    }
  },

  _openDrawer: function(e){
    this.$.drawer.openDrawer();
  },

  _isNotIconMenu: function(item){
    return !item.isIconMenu;
  },

  _getDropdownLabel: function(title, value){
    return title + ' ' + value;
  },

  _userSectionTapped: function(e){
    if(this.user.isLoggedIn){
      if(this.postLogin.url)
        window.location = this.postLogin.url;
    }
  },

  _hasUrlTrigger: function(item){
    return (item.url !== undefined && item !== null && item.length > 0);
  },

  _getDropdownClasses: function(isIconMenu){
    if(isIconMenu)
      return "dropdown";
    return "small dropdown" ;
  },

  _hideIfResponsiveScreenAndIconMenu: function(notDesktop, isIconMenu){
    return notDesktop && isIconMenu;
  },
  _getTopStartMenu: function(isMobile, items){
    if(isMobile){
      var array=[];
      array.push(items[0]);
      return array;
    }
    return items;
  }
})
    </script>
</dom-module>
